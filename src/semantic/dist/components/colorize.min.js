!function(e,n,i,t){"use strict";n=void 0!==n&&n.Math==Math?n:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")(),e.fn.colorize=function(n){var i=e.isPlainObject(n)?e.extend(!0,{},e.fn.colorize.settings,n):e.extend({},e.fn.colorize.settings),a=arguments||!1;return e(this).each(function(n){var o,r,c,s,d,g,l,u,f=e(this),m=e("<canvas />")[0],h=e("<canvas />")[0],p=e("<canvas />")[0],w=new Image,b=i.colors,y=(i.paths,i.namespace),v=i.error,C=f.data("module-"+y);if(u={checkPreconditions:function(){return u.debug("Checking pre-conditions"),!(!e.isPlainObject(b)||e.isEmptyObject(b))||(u.error(v.undefinedColors),!1)},async:function(e){i.async?setTimeout(e,0):e()},getMetadata:function(){u.debug("Grabbing metadata"),s=f.data("image")||i.image||t,d=f.data("name")||i.name||n,g=i.width||f.width(),l=i.height||f.height(),0!==g&&0!==l||u.error(v.undefinedSize)},initialize:function(){u.debug("Initializing with colors",b),u.checkPreconditions()&&u.async(function(){u.getMetadata(),u.canvas.create(),u.draw.image(function(){u.draw.colors(),u.canvas.merge()}),f.data("module-"+y,u)})},redraw:function(){u.debug("Redrawing image"),u.async(function(){u.canvas.clear(),u.draw.colors(),u.canvas.merge()})},change:{color:function(e,n){if(u.debug("Changing color",e),b[e]===t)return u.error(v.missingColor),!1;b[e]=n,u.redraw()}},canvas:{create:function(){u.debug("Creating canvases"),m.width=g,m.height=l,h.width=g,h.height=l,p.width=g,p.height=l,o=m.getContext("2d"),r=h.getContext("2d"),c=p.getContext("2d"),f.append(m),o=f.children("canvas")[0].getContext("2d")},clear:function(e){u.debug("Clearing canvas"),c.fillStyle="#FFFFFF",c.fillRect(0,0,g,l)},merge:function(){e.isFunction(o.blendOnto)?(o.putImageData(r.getImageData(0,0,g,l),0,0),c.blendOnto(o,"multiply")):u.error(v.missingPlugin)}},draw:{image:function(e){u.debug("Drawing image"),e=e||function(){},s?(w.src=s,w.onload=function(){r.drawImage(w,0,0),e()}):(u.error(v.noImage),e())},colors:function(){u.debug("Drawing color overlays",b),e.each(b,function(e,n){i.onDraw(c,d,e,n)})}},debug:function(e,n){i.debug&&(n!==t?console.info(i.name+": "+e,n):console.info(i.name+": "+e))},error:function(e){console.warn(i.name+": "+e)},invoke:function(n,a,o){var r;return o=o||Array.prototype.slice.call(arguments,2),"string"==typeof n&&C!==t&&(n=n.split("."),e.each(n,function(n,t){return e.isPlainObject(C[t])?(C=C[t],!0):e.isFunction(C[t])?(r=C[t],!0):(u.error(i.error.method),!1)})),!!e.isFunction(r)&&r.apply(a,o)}},C!==t&&a)return"invoke"==a[0]&&(a=Array.prototype.slice.call(a,1)),u.invoke(a[0],this,Array.prototype.slice.call(a,1));u.initialize()}),this},e.fn.colorize.settings={name:"Image Colorizer",debug:!0,namespace:"colorize",onDraw:function(e,n,i,t){},async:!0,colors:{},metadata:{image:"image",name:"name"},error:{noImage:"No tracing image specified",undefinedColors:"No default colors specified.",missingColor:"Attempted to change color that does not exist",missingPlugin:"Blend onto plug-in must be included",undefinedHeight:"The width or height of image canvas could not be automatically determined. Please specify a height."}}}(jQuery,window,document);